<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>김리은의 소개</title>
  <script src="..."></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Dongle&family=Gowun+Dodum&family=Jua&family=Nanum+Pen+Script&display=swap');

  * {
    font-family: "Jua", sans-serif;
  }

  body {
    background-color: black;
  }

  .header {
    background-size: cover;
    background-image:
      url('https://png.pngtree.com/thumb_back/fw800/background/20231219/pngtree-pink-pastel-background-with-pink-aesthetic-sky-image_15522922.png');
    background-position: right;
    height: 300px;
    display: flex;
    flex-direction: column;
    display: flex;
    align-items: center;
    text-align: center;
    color: #fff;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
  }

  .card {
    width: 1000px;
    /* 카드의 너비를 1000px로 변경 */
    height: 700px;
    /* 카드의 높이를 700px로 변경 */
    margin: 200px auto;
    background-color: transparent;
    color: white;
    border: 2px solid white;
    padding: 55px;
    text-align: center;
    text-shadow: -1px 0px black, 0px 1px black, 1px 0px black, 0px -1px black;

    .col-md-4 {
      padding: 5px;
    }

    .card-title1 {
      font-size: 50px;
      margin-top: 10px auto 0px auto;
      margin-top: 30px;
    }

    .card-text1 {
      font-size: 30px;
    }

    .card-title2 {
      margin-top: 20px;
    }

    .card-title3 {
      background-color: rgba(255, 255, 255, 0.5);
      border: 3px solid white;
      font-size: 30px;
    }

    .col {
      height: 600px;
      /* 각 카드의 높이를 600px로 변경 */
      color: white;
      border: 5px solid white;
      padding: 5px;
      margin: 10px auto;
    }
  }

  .homebtn {
    background-color: #ff69b4;
    border: 0px solid white;
  }

  .homebtn:hover {
    background-color: #ff1493;
  }

  .visitor {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 20px;
    max-width: 1200px;
    margin: 30px auto;
    display: flex;
    justify-content: space-around;
  }

  .visitbox {
    display: flex;
    justify-content: space-between;
  }

  .visitor-title {
    color: #fff;
    text-align: center;å
    margin-bottom: 20px;
    font-size: 28px;
  }

  .guestbook-form {
    margin-bottom: 20px;
  }

  .guestbook-form input,
  .guestbook-form textarea {
    margin-bottom: 10px;
    background-color: rgba(255, 255, 255, 0.2);
    border: none;
    color: #fff;
  }

  .guestbook-form input::placeholder,
  .guestbook-form textarea::placeholder {
    color: rgba(255, 255, 255, 0.7);
  }

  .guestbook-form button {
    width: 100%;
    background-color: #ff69b4;
    border: none;
  }

  .guestbook-form button:hover {
    background-color: #ff1493;
  }

  .guestbook-list {
    max-height: 300px;
    overflow-y: auto;
  }

  .leftbox {
    margin-right: 30px;
  }

  .message {
    display: flex;
    flex-wrap: nowrap;
    justify-content: space-between;
  }

  .actions {
    margin-left: 20px;
  }

  .guestbook-entry {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    width: 500px;
  }

  .guestbook-entry p {
    margin: 0;
    color: #fff;
  }

  .guestbook-entry .writer {
    font-weight: bold;
    color: #ff69b4;
  }

  .guestbook-entry .date {
    font-size: 0.8em;
    color: rgba(255, 255, 255, 0.7);
  }

  .guestbook-entry .content {
    margin-top: 5px;
  }

  .guestbook-entry .actions {
    margin-top: 10px;
  }

  .guestbook-entry .actions button {
    background-color: transparent;
    border: 1px solid #fff;
    color: #fff;
    padding: 5px 10px;
    margin-right: 5px;
    border-radius: 5px;
    font-size: 0.8em;
  }

  .guestbook-entry .actions button:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  a {
    text-decoration-line: none;
  }
</style>

<body>


  <div class="header">
    <div class="p-5 mb-4 bg-body-tertiary rounded-3">
      <div class="container-fluid py-5">
        <div class="jumbotron-message">
          <h1 class="display-5" style="font-family: 'Black Han Sans', sans-serif; ">안녕하세요. 김리은입니다.
          </h1>
          <p class="col-md-8 fs-4">
            <br>
          </p>
          <div class="card">
            <div class="row g-0">
              <h5 class="card-title1">김리은 ESTJ</h5>
              <div class="col-md-4">
                <img
                  src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcjPWAt%2FbtsKt96UIxp%2Fu805ku7SfG86Kllj7gFL00%2Fimg.png"
                  class="img-fluid rounded-start" alt="...">
                <h5 class="card-title2">
                  <p>내일배움캠프</p>
                  <p>spring 4기 1조 김리은입니다 :)</p>
                </h5>
              </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title3">내 소개</h5>
                  <p class="card-text1">세 아이와 강아지를 <br>키우고 있는 엄마사람입니다.</p>
                  <h5 class="card-title3">나만의 장점</h5>
                  <p class="card-text1">회계를 통해 배운 꼼꼼함과 <br>오류를 찾아내는 능력입니다.</p>
                  <h5 class="card-title3">협업 스타일</h5>
                  <p class="card-text1">잘 모르는 부분은 질문하고 <br>상대의 의견을 구합니다.</p>
                  <p class="card-text2"><small class="text-body-secondary"><a href="https://creator0920.tistory.com/">
                        <h1><span style="color: palevioletred; font-size: 20px;">개인블로그 바로가기</span></h1>
                      </a></small></p>
                </div>
              </div>
            </div>
          </div>
          <div class="mycards">
            <div class="member-cards row row-cols-1 row-cols-md-4">
              <!-- <div class="col">
                  <div class="card1 h-50">
                    <img
                      src="${member.image_url}"
                      class="card-img-top" alt="...">
                    <div class="card-body">
                      <h5 class="card-title">${member.name}</h5>
                    </div>
                  </div> -->
            </div>

            <button id="home" class="homebtn btn-primary" onclick = "location.href ='../../index.html'"></a>홈으로 나가기</button>

            <div class="visitor">
              <!-- 이미지 섹션 -->
              <div class="visitor-image me-4">
                <img src="https://cdn.011st.com/11dims/resize/1000x1000/quality/75/11src/product/7288969799/B.jpg?247000000" alt="방명록" style="width: 300px; border-radius: 15px;">
              </div>
              
              <!-- 방명록 폼 및 목록 -->
              <div class="visitbox">
                <div class="leftbox">
                <h2 class="visitor-title">방명록을 남겨주세요!</h2>v
                <div class="guestbook-form">
                  <input type="text" id="writer" placeholder="작성자" class="form-control">
                  <textarea id="writing" rows="4" placeholder="내용을 입력하세요." class="form-control"></textarea>
                  <button id="okay" class="btn btn-primary">방명록 작성</button>
                  </div>
                </div>
                <div id="guestbook-entries" class="guestbook-list"></div>
              </div>
            </div>


            
            <script type="module">
              import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
              import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
              
              const firebaseConfig = {
                apiKey: "AIzaSyAcNxdfupglLDv1Z18wYRBn-AZelw8OhEk",
                authDomain: "introduce-ourselves.firebaseapp.com",
                projectId: "introduce-ourselves",
                storageBucket: "introduce-ourselves.firebasestorage.app",
                messagingSenderId: "510644864006",
                appId: "1:510644864006:web:b252705d880832136c6f87",
                measurementId: "G-SK0R8C7M9R"
              };

              const app = initializeApp(firebaseConfig);
              const db = getFirestore(app);

              const url = new URLSearchParams(window.location.search);
              const memberId = url.get('id');
              console.log(memberId);


              async function loadMembers(memberId) {
                try {
                  const memberCards = document.querySelector('.member-cards');
                  const querySnapshot = await getDocs(collection(db, 'members'));

                  querySnapshot.forEach((doc) => {
                    const member = doc.data();
                    if (doc.id != memberId) {
                      const card = createMemberCard(doc.id, member);
                      memberCards.appendChild(card);
                    }
                  });
                } catch (error) {
                  console.error('Error loading members:', error);
                }
              }

              function createMemberCard(id, member) {
                const card = document.createElement('div');
                card.className = 'col';
                card.onclick = () => window.location.href = `../../member/${member.initials}/detail_page.html?id=${id}`;
                card.innerHTML = `
            <div class="card1 h-50">
                <img src="${member.image_url}" class="card-img-top" style="width: 200px; height: 210px;" alt="${member.name} Photo">
                <div class="card-body">
                    <h5 class="card-title">${member.name}</h5>
                </div>
            </div>
        `;
                return card;
              }

              document.addEventListener('DOMContentLoaded', () => {
                const memberId = new URLSearchParams(window.location.search).get('id');
                loadMembers(memberId); // 멤버 정보 불러오기
                displayGuestbookEntries(); // 방명록 데이터 표시
              });

              // 방명록 작성 버튼 클릭 시 Firestore에 데이터 저장
              document.getElementById('okay').onclick = async function () {
                const writer = document.getElementById("writer").value;
                const content = document.getElementById("writing").value;
                const date = new Date().toLocaleDateString();

                if (writer && content) {
                  try {
                    await addDoc(collection(db, "guestbook"), { writer, content, date });
                    alert("방명록이 작성되었습니다!");
                    document.getElementById("writer").value = "";
                    document.getElementById("writing").value = "";
                    displayGuestbookEntries(); // 방명록 목록 새로고침
                  } catch (error) {
                    console.error("Error adding document: ", error);
                  }
                } else {
                  alert("작성자와 내용을 입력하세요.");
                }
              }


              // Firestore에서 방명록 데이터 가져와 화면에 표시하기
              async function displayGuestbookEntries() {
                const guestbookEntries = document.getElementById("guestbook-entries");
                guestbookEntries.innerHTML = "";
                try {
                  const querySnapshot = await getDocs(collection(db, "guestbook"));
                  querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const entry = document.createElement("div");
                    entry.className = "guestbook-entry";
                    entry.innerHTML = `
                    <div class="message">
                    <p>
                      <span class="writer">${data.writer}</span><br>
                       <span class="date">${data.date}</span><br>
                   </p>
                    <p class="content">${data.content}</p>
                    <div class="actions">
                      <button onclick="editEntry('${doc.id}', '${data.content}')">수정</button>
                        <button onclick="deleteEntry('${doc.id}')">삭제</button>
                      </div>
                      </div>
                      `;
                    guestbookEntries.appendChild(entry);
                  });
                } catch (error) {
                  console.error("Error getting documents: ", error);
                }
              }

              // 방명록 삭제 기능
              window.deleteEntry = async function (id) {
                const confirmation = confirm("정말로 이 방명록을 삭제하시겠습니까?");
                if (confirmation) {
                  try {
                    await deleteDoc(doc(db, "guestbook", id));
                    alert("방명록이 삭제되었습니다.");
                    displayGuestbookEntries();
                  } catch (error) {
                    console.error("Error deleting document: ", error);
                  }
                }
              }
              // 방명록 수정 기능
              window.editEntry = async function (id, currentContent) {
                const newContent = prompt("수정할 내용을 입력하세요:", currentContent);
                if (newContent !== null && newContent !== "") {
                  try {
                    const docRef = doc(db, "guestbook", id);
                    await updateDoc(doc(db, "guestbook", id), { content: newContent });
                    alert("방명록이 수정되었습니다.");
                    displayGuestbookEntries(); // 방명록 목록 새로고침
                  } catch (error) {
                    console.error("Error updating document: ", error);
                  }
                }
              }

            </script>
</body>

</html>