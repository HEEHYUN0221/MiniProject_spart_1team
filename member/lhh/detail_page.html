<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTP 임희현</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Gothic+A1&display=swap');


        * {
            font-family: "Gothic A1", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        .header {
            background-size: cover;
            background-color: black;
            background-image: url('image/222.png');
            background-position: right;
            height: 300px;
            width: 75%;
            margin: 0 auto;
        }

        .header>h1 {
            margin: 0;
            font-size: 35px;
            color: rgb(0, 0, 0);
            margin-top: 20px;
            padding-top: 20px;
            text-align: center;
            font-weight: 800;
        }

        .myimage {
            background-color: green;
            height: 300px;
            width: 300px;
            margin-left: 10%;
            margin-right: 10px;
            border-radius: 50%;
            overflow: hidden;
        }

        .sogae {
            background-color: rgba(252, 193, 203, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-left: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            overflow: auto;
        }

        .sogae div {
            margin-bottom: 10px;
        }

        .sogae div:last-child {
            margin-bottom: 0;
        }

        .main {
            display: flex;
            align-items: center;
            margin-top: 30px;
            margin-left: auto;
            margin-bottom: 50px;
        }


        .blogbtn {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            margin-left: 20px;
        }

        .imageblog {
            margin-left: 200px;
            margin-right: 40px;
        }
        .littletitle {
            margin: 0;
            font-size: 24px;
            color: rgb(165, 6, 104);
            margin-bottom: 40px;
            padding-top: 20px;
            text-align: center;
            font-weight: 800;
        }

        .mystyle {
            height: 30px;
            width: 600px;
            background-color: bisque;
            margin-bottom: 30px;
        }

        .goal {
            height: 30px;
            width: 600px;
            background-color: bisque;
        }

        .card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin: 0 10px;
        }


        .dinner-container {
            height: 400px;
            background-color: white;
            margin: 0 300px;
            padding: 100px, 100px;
        }

        .button2 {
            float: left;
            width: 160px;
            margin-left: 10px;
            margin-top: 25px;
        }

        #anotherMemberContainer {
            display: flex; /* Flexbox 사용 */
            justify-content: space-around; /* 이미지 간의 간격 균등하게 */
            flex-wrap: nowrap; /* 한 줄에 배치 */
        }

        .card {
            flex: 1 0 auto;
            max-width: 150px; /* 카드의 최대 너비 설정 */
        }

        .card-body {
            text-align: left; /* 텍스트 정렬 */
            width: 100%; /* 카드 너비에 맞추기 */
        }

        .card-text {
            word-wrap: break-word; /* 긴 단어가 있을 경우 줄바꿈 처리 */
            overflow-wrap: break-word; /* 텍스트가 넘칠 경우 줄바꿈 처리 */
        }

        .card-img-top {
            width: 100%; /* 이미지 너비를 부모 요소에 맞춤 */
            height: auto; /* 이미지 높이를 비율에 맞게 자동 조정 */
            max-width: 150px; /* 최대 너비 설정 (필요에 따라 조정 가능) */
        }

        .dinner-getcontainer {
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin: 0 auto;
        }

        .container008 {
            margin-top: 20px;
            height: auto;
        }

        .d-day-box {
            background-color: rgba(0, 0, 0, 0.8);
            color:white;
            border-radius: 10px;
            padding: 10px;
            margin-top: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-left:20px;
        }
    </style>
    <script type="module">


        // Firebase SDK import
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, doc, getDocs, getDoc, deleteDoc, addDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAcNxdfupglLDv1Z18wYRBn-AZelw8OhEk",
            authDomain: "introduce-ourselves.firebaseapp.com",
            projectId: "introduce-ourselves",
            storageBucket: "introduce-ourselves.firebasestorage.app",
            messagingSenderId: "510644864006",
            appId: "1:510644864006:web:b252705d880832136c6f87",
            measurementId: "G-SK0R8C7M9R"
        };

        const firebaseConfig_fordinner = {
            apiKey: "AIzaSyC6QqSDDcKkGB5i0_ZzcWjejGiMVTva1nY",
            authDomain: "spartaproject-da9c3.firebaseapp.com",
            projectId: "spartaproject-da9c3",
            storageBucket: "spartaproject-da9c3.firebasestorage.app",
            messagingSenderId: "1023750339528",
            appId: "1:1023750339528:web:670ab80bd4f14704b1defd"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const app2 = initializeApp(firebaseConfig_fordinner, "secondary");
        const db2 = getFirestore(app2);

        const urlParams = new URLSearchParams(window.location.search);
        const memberId = urlParams.get('id');
        console.log(memberId);

        async function getMemberData(memberId) {

            try {
                const docSnap = await getDoc(doc(db, 'members', memberId));
                if (docSnap.exists()) {
                    const memberData = docSnap.data();
                    document.getElementById("memberName").innerText = `${memberData.name} 의 소개`
                    document.getElementById("membermbti").innerText = memberData.mbti;

                    const blogButton = document.getElementById("blogBtn");
                    blogButton.onclick = () => window.location.href = memberData.blog_url;//블로그 버튼을 누르면 블로그로 이동

                } else {
                    console.log("No such document!");
                    document.getElementById("memberInfo").innerText = "Member not found.";//id에 맞는거 없으면 에러 출력
                }
            } catch (error) {
                console.error("Error getting document:", error); //데이터 못받아오면 에러 출력
            }
        }

        async function getanotherMemberData() {
            const membersRef = collection(db, 'members'); // members 컬렉션 가져옴
            try {
                const querySnapshot = await getDocs(membersRef); // 아까랑 달리 모든 멤버 문서 가져옴
                const anotherMemberContainer = document.getElementById("anotherMemberContainer"); // 카드가 추가될 컨테이너 가져옴

                querySnapshot.forEach((doc) => {
                    const memberData = doc.data(); // 데이터 가져오기
                    if (doc.id != memberId) {
                        // 카드 생성
                        const card = document.createElement('div');
                        card.className = 'card'; // 카드 클래스 추가 > 스타일에서 수정 예정

                        // 카드에 이미지 추가
                        const img = document.createElement('img');
                        img.src = memberData.image_url; // 데이터베이스에서 가져온 image_url 사용
                        img.alt = `${memberData.name}의 이미지`; // 이미지없을 경우 대체 텍스트 출력
                        img.className = 'card-img-top'; //카드 이미지 클래스 추가 > 스타일에서 수정 예정
                        img.onclick = () => {
                            location.href = `../${memberData.initials}/detail_page.html?id=${doc.id}`;//이미지 클릭 시 다른 멤버 상세 페이지로 이동
                        };
                        card.appendChild(img); //위에 만든 카드에 이미지를 추가함

                        // 카드 바디 추가
                        const cardBody = document.createElement('div'); //설명이랑 제목 넣을 부분 텍스트, 데이터베이스에서 name, tmi 사용
                        cardBody.className = 'card-body'; // 카드바디 클래스 추가 > 스타일에서 수정 예정

                        // 카드 제목 추가
                        const name = document.createElement('h5'); //이름 들어갈 부분
                        name.className = 'card-name'; //이름 들어갈 부분 클래스 > 스타일에서 폰트 따로 설정 해줘야 되는지?
                        name.innerText = memberData.name || "이름 없음";
                        cardBody.appendChild(name); // 카드 바디에 이름 추가

                        // 카드 텍스트 추가
                        const tmi = document.createElement('p'); //tmi 추가할 부분
                        tmi.className = 'card-text'; // tmi 스타일 조정 부분
                        tmi.innerText = memberData.tmi || "정보 없음"; // tmi 내용 가져옴
                        cardBody.appendChild(tmi); // 카드 바디에 tmi 추가 , 이름 뒤에 와야함


                        card.appendChild(cardBody); // 카드 바디를 카드에 추가

                        anotherMemberContainer.appendChild(card); // 카드 추가
                    }


                });
            } catch (error) {
                console.error("Error getting documents:", error); // 오류 처리
            }

        }

        $("#input-dinnerBtn").click(async function () {
            let text = $('#input-dinner').val();
            let text2 = $('#input-reason').val();
            console.log(text);
            let doc = {
                'text': text,
                'reason': text2
            };

            try {
                const docRef = await addDoc(collection(db2, "dinner"), doc
                );
                alert("음식이 추가 되었습니다!");
                window.location.reload();
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        });//버튼을 누르면 데이터베이스에 웹에서 입력한 텍스트가 저장됨


        async function getdinner() {
            const querySnapshot = await getDocs(collection(db2, "dinner"));
            $(".dinner-getcontainer").empty();
            querySnapshot.forEach((doc) => {
                let text = doc.data().text;
                let reason = doc.data().reason;
                let tempHtml = `<div class="row g-4"><div class="col-sm">
    <input type="text" class="form-control" placeholder="Name" aria-label="음식명" value="${text}">
  </div><div class="col-sm-7">
    <input type="text" class="form-control" placeholder="Reason" aria-label="추천이유" value="${reason}">
  </div> <div class="col-sm">
    <button type="button" class="btn btn-danger edit-dinner" data-id="${doc.id}"> 수정하기 </button> <!-- 수정 버튼 추가 -->
</div><div class ="col-sm"><button type="button" class="btn btn-danger delete-dinner" data-id="${doc.id}"> 삭제하기 </button></div>`
                $(".dinner-getcontainer").append(tempHtml);
                console.log(doc.id);
            });

        }//입력되있던 dinner 메뉴들을 불러옴

        $(".dinner-getcontainer").on("click", ".delete-dinner", async function () {
            const row = $(this).closest('.row');
            console.log(row);
            const docId = $(this).data('id');
            console.log(docId);

            try {
                await deleteDoc(doc(db2, "dinner", docId));
                alert("삭제가 완료되었습니다!");
                row.remove(); // UI에서 해당 행을 제거합니다
            } catch (error) {
                console.error("Error removing document: ", error);
            }
        });

        $(".dinner-getcontainer").on("click", ".edit-dinner", async function () {
            const docId = $(this).data('id'); // 수정할 문서의 ID 가져오기
            const newText = prompt("새로운 음식명을 입력하세요:");
            const newReason = prompt("새로운 추천 이유를 입력하세요:");

            if (newText && newReason) {
                try {
                    // Firestore 문서 참조
                    const docRef = doc(db2, "dinner", docId);

                    // 문서 업데이트
                    await updateDoc(docRef, {
                        text: newText,
                        reason: newReason
                    });

                    alert("데이터가 성공적으로 수정되었습니다!");
                    window.location.reload(); // 페이지 새로고침하여 변경 사항 반영
                } catch (error) {
                    console.error("Error updating document: ", error);
                }
            } else {
                alert("음식명과 추천 이유를 모두 입력해야 합니다.");
            }
        });

        const targetDate = new Date('2025-03-17');

        // D-Day 계산 함수
        function calculateDDay() {
            const today = new Date(); // 현재 날짜
            const timeDifference = targetDate - today; // 목표 날짜와 현재 날짜의 차이 (밀리초)

            // 밀리초를 일 단위로 변환 (1일 = 1000ms * 60초 * 60분 * 24시간)
            const daysRemaining = Math.ceil(timeDifference / (1000 * 60 * 60 * 24));

            // D-Day 값 업데이트
            document.getElementById('d-day').innerText = `D-${daysRemaining}`;
        }


        document.addEventListener("DOMContentLoaded", () => {
            getMemberData(memberId);  // 나의memberId로 데이터 가져오기
            getanotherMemberData(); // 다른 멤버의 데이터를 가져와서 카드에 넣을 것
            getdinner(); // 저녁메뉴 불러오기
            calculateDDay();
        });
    </script>

</head>

<body>
    <header class="header">
        <h1> <span id="membermbti"> </span><span id="memberName"></span></h1>
    </header>
    <div class="main">
        <div class="imageblog">
            <div class="myimage">
                <img src="image/KakaoTalk_20241021_144840718.jpg" height="300">
            </div>
            <span class="blogbtn">
                <button type="button" class="btn btn-outline-danger" id="blogBtn">블로그 가기</button>
            </span>
        </div>

        <div class="sogae">
            <div class="mystyle">제 mbti는 intp 입니다! </div>
            <div class="mystyle">저는 게임과 여행을 좋아합니다.</div>
            <div class="mystyle">사전캠프 기간때에 혼자 후쿠오카를 다녀왔습니다.</div>
            <div class="goal">저에게 큰 목표는 없지만, 당장의 목표는 프로젝트 무사히 끝내기입니다!!!</div>
        </div>
        <div class="d-day-box">
            <span id="d-day">D-87</span> <!-- D-Day 표시 -->
        </div>
    </div>

    <div class=dinner-container>

        <div class="row g-4">
            <div class="col-sm">
                <input type="text" class="form-control" id="input-dinner" placeholder="Name" aria-label="음식명">
            </div>
            <div class="col-sm-7">
                <input type="text" class="form-control" id="input-reason" placeholder="Reason" aria-label="추천이유">
            </div>

            <div class="button2">
                <button type="button" class="btn btn-danger" id="input-dinnerBtn"> 추천하기 </button>
            </div>
        </div>
        <div class="container008">
            <div class="dinner-getcontainer"></div>

        </div>
    </div>


        <div class="littletitle">다른 멤버 소개 보러가기</div>
        <div class="container mt-4">
            <div class="card-container" id="anotherMemberContainer"></div>
        </div>


</body>

</html>